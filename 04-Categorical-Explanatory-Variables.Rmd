
# Categorical Data & Rotated Models: Simulated hair data

This dataset on hair lengths demonstrates how directional regression analysis can provide useful insights into regressions with categorical explanatory variables. It is a simulated dataset that shows a relationship between gender identification and hair length. The gender categories used in this simulation are male, female, and nonbinary. 

```{r }
hairData <-read.csv("/Users/mfoster1/Dropbox/research/statVizBook/efm_hair.csv")
# hairData <-read.csv("C:\\Users\\Ella\\Dropbox\\research\\statVizBook\\efm_hair.csv")

```

## Directional regression results

To understand the rotations and subsets that are created in the models, it's first important to understand how categorical variables are represented in  a regression. Each category within the categorical variable represents its own axis. Each category's axis has FALSE/0 represent those observations that are not part of that category, and TRUE/1 represent those observations that are part of the category. For example, the female axis has 1 indicate females, and 0 indicate not females. Programs typically code 0 as FALSE, and 1 as TRUE. 

However, every new axis must provide new information in the model. You can see in the left hand image below that the coordinate system that uses female and male as the axes uniquely identify the nonbinary folk at the origin of the plot; they are the only group that is both not female and not male, because there are only 3 categories available. The rotation of these axes on the right hand side uses nonbinary and female as the axes, and equally shows that the male category is uniquely represented at the origin. An additional axis to represent the category that is at the origin would not provide new information, and therefore is not allowed in a regression. Some programs (like R) will simply drop redundant variables if you try to include them in a regression, while others will throw errors. 

```{r fig.height = 3.5 , fig.width = 7.5, fig.align='center'}
hair_female.male <- ggplot(data = hairData, aes(x = isFemale_num, y = isMale_num, color = gender)) +
  geom_jitter(alpha = .3, height = .05, width = .05)+
  scale_color_manual(values = c("pink","skyblue","purple")) + 
  theme_classic()+
  labs(x = "nonbinary vs female", y = "nonbinary vs male")

hair_female.nonbinary <- ggplot(data = hairData, aes(x = isFemale_num, y = isNonbinary_num, color = gender)) +
  geom_jitter(alpha = .3, height = .05, width = .05)+
  scale_color_manual(values = c("pink","skyblue","purple")) + 
  theme_classic()+
  labs(x = "male vs female", y = "male vs nonbinary")

ggarrange(hair_female.male,hair_female.nonbinary, nrow=1, common.legend = T)
```

The regression results for this model are created using the stargazer.dira() command in the DiRA package. The results below show the rotations and nests of the multiple regression based on the left hand axis system in the plots above, where the x1-axis represents females and the x2-axis represents males.

  - **Model 1** shows the regression $length = 6.042 * female  - 2.658* male + 4.589$. The reference category is nonbinary, so females tend to have hair lengths 6.042 inches longer than nonbinary folk. Men tend to have hair lengths 2.658 inches shorter than nonbinary folk.
  - **Model 2** shows the rotation of the female and male axes that represents the direct comparison between males and females. This is done by telling stargazer.dira() to show the results for a rotation of the original axes where the primary axis moves from the point (not female, male) = (0, 1) to the point (female, not male) = (1,0). This rotation shows that females tend to have hair lengths 8.7 inches longer than men. There is also an orthogonal component included; without it, the male vs female direction would be a joint direction from male to a combination of female and male instead of the difference between males and female holding the nonbinary variable constant. The orthogonal component has no meaningful interpretation on its own.
  - **Model 3** shows the nested model $length = 6.042 * female + 4.589$ where coefficients are estimated from a dataset subsets to only those folk who are not male, and are therefore either nonbinary or female. Naturally, the regression predicts the mean hair length difference between females and nonbinary folk. Note that while the coefficient for female is identical between Model 1 and Model 3, the standard errors are different.
  - **Model 4** shows the nested model $length = -2.658 * male + 4.589$ where coefficients are estimated from a dataset subsets to only those folk who are not female, and are therefore either nonbinary or male. Naturally, the regression predicts the mean hair length difference between males and nonbinary folk.
  - **Model 5** shows the nested model $length = 8.700 * female + 1.931$ where coefficients are estimated from a dataset subsets to only those folk who are not nonbinary, and are therefore either female or male. Naturally, the regression predicts the mean hair length difference between males and nonbinary folk, and the coefficient (but not standard errors) is identical to the first coefficient in the rotated model using the direction from (0,1) to (1,0).

```{r, results = 'asis'}
model.names <-  c("lm_multiple", 
                  "lm_new.direction", "lm_y.predby.x1.subset.x2.0", 
                  "lm_y.predby.x2.subset.x1.0","lm_y.predby.x1.subset.x1ORx2.1" ) 

stargazer.dira(formula = length~ isFemale_num+isMale_num, data = hairData, 
               model.names = model.names, print.model.descriptions = F,
               direction.start.x1 = 0, direction.end.x1 = 1, 
               direction.start.x2 = 1, direction.end.x2 = 0,
               units.of.x1 = T, 
               type = type, 
               keep.stat = c("n","aic", "adj.rsq", "f"),
               star.cutoffs = c(0.05, 0.01, 0.001),
               covariate.labels = c("nonbinary vs female", "nonbinary vs male", "male vs female",
                                    "orthogonal to male v female", "Constant"),
               dep.var.caption = "hair length")
```


The next set of regression results use the second axis system, where the x1-axis represents females, and the x2-axis represents nonbinary folk. The origin therefore represent males. There is a clear symmetry between the first set of regression results and the second. The third axis system, using nonbinary and male for the axes, would produce a similar symmetry.

```{r, results = 'asis'}
stargazer.dira(formula = length~ isFemale_num+isNonbinary_num, data = hairData, 
               model.names = model.names, print.model.descriptions = F,
               direction.start.x1 = 0, direction.end.x1 = 1, 
               direction.start.x2 = 1, direction.end.x2 = 0, 
               units.of.x1 = T, 
               type = type, 
               keep.stat = c("n","aic", "adj.rsq", "f"),
               star.cutoffs = c(0.05, 0.01, 0.001),
               covariate.labels = c("male vs female", "male vs nonbinary", "nonbinary vs female",
                                    "orthogonal to nonbinary vs female", "Constant"),
               dep.var.caption = "hair length")
```

## 3D rotated model

The next images show the 3D regression surface.
  
  - The marginal effect of $x_1$, the axis for whether the respondent is female, is shown with a <span style="color: crimson;">red</span> line. This shows the mean difference between the hair lengths of females and nonbinary folk.
  - The slope of the nested model subsetted to include only nonbinary and female folk is shown with a <span style="color: violet;">pink</span> dashed line. Note that the confidence interval is substantially wider than that for the marginal effect.
  - The marginal effect of $x_1$, the axis for whether the respondent is male, is shown with a <span style="color: darkorange;">orange</span> line. 
  - The slope of the nested model subsetted to include only nonbinary and male folk is shown with a <span style="color: gold;">yellow</span> dashed line. Note that the confidence interval is substantially narrower than that for the marginal effect.
  - The marginal effect of the new direction, the axis that goes between the categories nonbinary and male, is shown with a <span style="color: green;">green</span> line. This has by far the steepest slope. Because it moves between the categories with the most observations, it also has the narrowest confidence interval.
  - The slope of the nested model subsetted to include only male and female folk is shown with a <span style="color: limegreen;">light green</span> dashed line. Although the confidence interval looks almost identical to the marginal effect for the new direction, it is in fact slightly smaller.

```{r fig.height = 6.5 , fig.width = 8.5, fig.align='center'}

plot_ly( ) %>%
  add_markers(data = hairData, 
              x = ~isFemale_num,
              y = ~isMale_num,
              z = ~length,
              color = ~gender,
              colors = c("pink", "skyblue", "purple"),
              size = 1) %>% 
  add_3d.directions(formula = length~ isFemale_num+isMale_num, data = hairData,
                     model.names = model.names, define.constant.x1 =0 ,define.constant.x2 =0 ) %>%
  layout( 
    title = "\nSimulated hair length by\n gender",
    scene = list(xaxis = list(title = 'female (0 = no, 1 = yes)'),
                 yaxis = list(title = 'male (0 = no, 1 = yes)'),
                 zaxis = list(title = 'hair length')),
    legend = list(font = list(size = 8))
  )
```

## 2D visuals

```{r fig.height=8, fig.width=8}
p <- plot_ly(data = hairData, 
              x = ~isFemale_num,
              y = ~isMale_num,
              z = ~length,
              color = ~gender,
              colors = c("pink", "skyblue", "purple"),
              size = 1 ) %>%
  add_markers() %>% 
  layout( 
    title = "\nSimulated hair length by\n gender",
    scene = list(xaxis = list(title = 'female (0 = no, 1 = yes)'),
                 yaxis = list(title = 'male (0 = no, 1 = yes)'),
                 zaxis = list(title = 'hair length')),
    legend = list(font = list(size = 8))
  )


 p %>% add_2d.directions(model.names) 

```



