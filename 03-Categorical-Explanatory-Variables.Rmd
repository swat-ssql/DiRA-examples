
# Categorical Data & Rotated Models: Simulated hair data {#CategoricalVar}

Directional regression analysis can allow the comparison between all possible pairwise comparisons of a categorical variable using a single regression surface. Although the principal can be applied to as variables with as many categories as needed, the DiRA package currently only allows for a direct analysis of categorical variables with 3 or fewer categories.

This example uses a simulated dataset that shows a relationship between gender identification and hair length. The gender categories used in this simulation are male, female, and nonbinary. 

## Understanding categorical variables

To understand the rotations and subsets that are created in the models, it's first important to understand how categorical variables are represented in  a regression. Each category within the categorical variable represents its own axis. Each category's axis has FALSE/0 represent those observations that are not part of that category, and TRUE/1 represent those observations that are part of the category. For example, the female axis has 1 indicate females, and 0 indicate not females. Programs typically code 0 as FALSE, and 1 as TRUE. 

However, every new axis must provide new information in the model. You can see in the image below that a coordinate system using female and male as the axes uniquely identifies the nonbinary folk at the origin of the plot; they are the only group that is both not female and not male, because there are only 3 categories available. An additional axis to represent the category that is at the origin would not provide new information, and therefore is not allowed in a regression. Some programs (like R) will simply drop redundant variables if you try to include them in a regression, while others will throw errors. 

```{r fig.height = 2.5 , fig.width = 5, fig.align='center'}
ggplot(data = hairData, aes(x = isFemale_num, y = isMale_num, color = gender)) +
  geom_jitter(alpha = .3, height = .05, width = .05)+
  scale_color_manual(values = c("pink","skyblue","purple")) + 
  theme_classic()+
  labs(x = "nonbinary vs female", y = "nonbinary vs male")

```

One result of this axis system is that only two comparisons are typically visible for the gender variable, because regression results typically only show marginal effects. The marginal effects for the axis system shown above would reflect the hair length difference between nonbinary folk and females, and between nonbinary folk and males. Neither marginal effect shows the difference between females and males, even though that difference is shown in the regression surface. To uncover it, we have to examine a *direction* in the regression surface, namely the direction from the point representing males, which is (0,1) = (not female, male), to the point representing females, which is (1,0) = (female, not male). This direction will produce both a slope that represents the difference in hair lengths between males and female, as well as a confidence interval. 

Computing this direction requires rotating the original $x_1$ and $x_2$ axes to reflect the new direction, then calculating marginal effects for the new rotated axes. The DiRA package does this for you, as shown below. 

## Directional regression results

The regression results for this model are created using the stargazer.dira() command in the DiRA package. 

  - **Model 1** shows the regression $length = 6.042 * female  - 2.658* male + 4.589$. The marginal effect of each variable shows the mean difference between the reference category and the category indicated by the variable. Since the reference category is nonbinary folk, females tend to have hair lengths 6.042 inches longer than nonbinary folk. Men tend to have hair lengths 2.658 inches shorter than nonbinary folk.
  - **Model 2** shows the rotation of the female and male axes that represents the direct comparison between males and females. This is done by telling stargazer.dira() to show the results for a rotation of the original axes where the primary axis moves from the starting point (not female, male) = (0, 1) to the ending point (female, not male) = (1,0). This rotation shows that females tend to have hair lengths 8.7 inches longer than men. There is also an orthogonal component included; without it, the male vs female direction would be a joint direction from male to a combination of female and male instead of the difference between males and female holding the nonbinary variable constant. The orthogonal component has no meaningful interpretation on its own.
 

```{r, results = 'asis'}
model.names <-  c("lm_multiple", 
                  "lm_new.direction" ) 

stargazer.dira(formula = length~ isFemale_num+isMale_num, data = hairData, 
               model.names = model.names, print.model.descriptions = F,
               direction.start.x1 = 0, direction.end.x1 = 1, 
               direction.start.x2 = 1, direction.end.x2 = 0,
               units.of.x1 = T, 
               type = type, 
               keep.stat = c("n","aic", "adj.rsq", "f"),
               star.cutoffs = c(0.05, 0.01, 0.001),
               covariate.labels = c("nonbinary vs female", "nonbinary vs male", "male vs female",
                                    "orthogonal to male v female", "Constant"),
               dep.var.caption = "hair length")
```




## 3D rotated model

The next images show the 3D regression surface.
  
  - The marginal effect of $x_1$, the axis for whether the respondent is female, is shown with a <span style="color: crimson;">red</span> line. This shows the mean difference between the hair lengths of females and nonbinary folk.
  - The marginal effect of $x_1$, the axis for whether the respondent is male, is shown with a <span style="color: darkorange;">orange</span> line. 
 - The marginal effect of the new direction, the axis that goes between the categories nonbinary and male, is shown with a <span style="color: green;">green</span> line. This has by far the steepest slope. Because it moves between the categories with the most observations, it also has the narrowest confidence interval.
  - The marginal effect of axis orthogonal to the new direction is shown with a <span style="color: limegreen;">light green</span> line. This line controls for the effect of nonbinary folk, but has no substantive interpretation on its own. It ensures that the marginal effect of the new direction accurately reflects the difference between males and females, instead of the difference between the hair length for a combination of nonbinary folk and females to the hair length of males.

```{r fig.height = 6.5 , fig.width = 8.5, fig.align='center'}

plot_ly( ) %>%
  add_markers(data = hairData, 
              x = ~isFemale_num,
              y = ~isMale_num,
              z = ~length,
              color = ~gender,
              colors = c("pink", "skyblue", "purple"),
              size = 1) %>% 
  add_3d.directions(formula = length~ isFemale_num+isMale_num, data = hairData,
                     model.names = model.names, define.constant.x1 =0 ,define.constant.x2 =0 ) %>%
  layout( 
    title = "\nSimulated hair length by\n gender",
    scene = list(xaxis = list(title = 'female (0 = no, 1 = yes)'),
                 yaxis = list(title = 'male (0 = no, 1 = yes)'),
                 zaxis = list(title = 'hair length')),
    legend = list(font = list(size = 8))
  )
```

## 2D visuals
```{r fig.height=7.5, fig.width=8}
p <- plot_ly(data = hairData, 
              x = ~isFemale_num,
              y = ~isMale_num,
              z = ~length,
              color = ~gender,
              colors = c("pink", "skyblue", "purple"),
              size = 1 ) %>%
  add_markers() %>% 
  layout( 
    title = "\nSimulated hair length by\n gender",
    scene = list(xaxis = list(title = 'female (0 = no, 1 = yes)'),
                 yaxis = list(title = 'male (0 = no, 1 = yes)'),
                 zaxis = list(title = 'hair length')),
    legend = list(font = list(size = 8))
  )

 # p %>% plotlist.2d(model.names, categories.3 = T) 
 p %>% add_2d.directions(model.names, categories.3 = T, define.constant.x1 =0 ,define.constant.x2 =0) 
```

The two dimensional visuals above show three crossections of the regression surface plotted in 3D. 

A deeper dive into understanding categorical explanatory variables is available in the optional Examples \@ref(categoricalRotationSymmetries) and \@ref(categoricalNestedModels):

  - Example \@ref(categoricalRotationSymmetries) shows how the rotated model shown above can be replicated by changing the reference category. 
  - Example \@ref(categoricalNestedModels) shows how nested models applied to a subset of the data can reproduce the marginal effects shown above. Although the marginal effects can be replicated using nested models, the confidence intervals are not the same.
  
(Note for later: One unanswered question regards the shape of the confidence intervals. The confidence interval shape for the coefficient on $x_1$ = isFemale_num clearly does not remain constant as $x_2$ = isMale_num changes. However, there is only one standard error associated with the marginal effect of $x_1$. Is this because the standard error represents some kind of average of the standard errors? Is the average error across the range of $x_1$ the same for all values of $x_2$, even as the error at any given point of $x_1$ changes? )


