
# (Optional) Subsetted Categorical Explanatory Variables & Nested Models: Simulated hair data {#categoricalNestedModels}

Example \@ref(CategoricalVar) and Example \@ref(categoricalNestedModels) began the exploration of into categorical explanatory variables.  The regression results already shown describe the differences in mean hair lengths between each of the pairwise comparisons in the categorical variable. This example continues that exploration. by showing that these differences can also be recovered using a nested model applied to a subset of the data. However, although the differences are identical between the regression surface and the nested models, the confidence intervals are not.

## Directional regression results

  - As before, **Model 1** shows the regression $length = 6.042 * female  - 2.658* male + 4.589$. The marginal effect of each variable shows the mean difference between the reference category and the category indicated by the variable. Since the reference category is nonbinary folk, females tend to have hair lengths 6.042 inches longer than nonbinary folk. Men tend to have hair lengths 2.658 inches shorter than nonbinary folk.
  - As before, **Model 2** shows the rotation of the female and male axes that represents the direct comparison between males and females. This is done by telling stargazer.dira() to show the results for a rotation of the original axes where the primary axis moves from the starting point (not female, male) = (0, 1) to the ending point (female, not male) = (1,0). This rotation shows that females tend to have hair lengths 8.7 inches longer than men. There is also an orthogonal component included; without it, the male vs female direction would be a joint direction from male to a combination of female and male instead of the difference between males and female holding the nonbinary variable constant. The orthogonal component has no meaningful interpretation on its own.
  - **Model 3** shows the nested model $length = 6.042 * female + 4.589$ where coefficients are estimated from a dataset subsets to only those folk who are not male, and are therefore either nonbinary or female. Naturally, the regression predicts the mean hair length difference between females and nonbinary folk. Note that while the coefficient for female is identical between Model 1 and Model 3, the standard errors are different.
  - **Model 4** shows the nested model $length = -2.658 * male + 4.589$ where coefficients are estimated from a dataset subsets to only those folk who are not female, and are therefore either nonbinary or male. Naturally, the regression predicts the mean hair length difference between males and nonbinary folk.
  - **Model 5** shows the nested model $length = 8.700 * female + 1.931$ where coefficients are estimated from a dataset subsets to only those folk who are not nonbinary, and are therefore either female or male. Naturally, the regression predicts the mean hair length difference between males and nonbinary folk, and the coefficient (but not standard errors) is identical to the first coefficient in the rotated model using the direction from (0,1) to (1,0).

```{r, results = 'asis'}
model.names <-  c("lm_multiple", 
                  "lm_new.direction", "lm_y.predby.x1.subset.x2.0", 
                  "lm_y.predby.x2.subset.x1.0","lm_y.predby.x1.subset.x1ORx2.1" ) 

stargazer.dira(formula = length~ isFemale_num+isMale_num, data = hairData, 
               model.names = model.names, print.model.descriptions = F,
               direction.start.x1 = 0, direction.end.x1 = 1, 
               direction.start.x2 = 1, direction.end.x2 = 0,
               units.of.x1 = T, 
               type = type, 
               keep.stat = c("n","aic", "adj.rsq", "f"),
               star.cutoffs = c(0.05, 0.01, 0.001),
               covariate.labels = c("nonbinary vs female", "nonbinary vs male", "male vs female",
                                    "orthogonal to male v female", "Constant"),
               dep.var.caption = "hair length")
```



## 3D rotated model

The next images show the 3D regression surface.
  
  - The marginal effect of $x_1$, the axis for whether the respondent is female, is shown with a <span style="color: crimson;">red</span> line. This shows the mean difference between the hair lengths of females and nonbinary folk.
  - The slope of the nested model subsetted to include only nonbinary and female folk is shown with a <span style="color: violet;">pink</span> dashed line. Note that the confidence interval based on the nested model is wider than that for the marginal effect based on the regression surface.
  - The marginal effect of $x_1$, the axis for whether the respondent is male, is shown with a <span style="color: darkorange;">orange</span> line. 
  - The slope of the nested model subsetted to include only nonbinary and male folk is shown with a <span style="color: gold;">yellow</span> dashed line. Note that the confidence interval based on the nested model is substantially narrower than that for the marginal effect based on the regression surface.
  - The marginal effect of the new direction, the axis that goes between the categories nonbinary and male, is shown with a <span style="color: green;">green</span> line. This has by far the steepest slope. Because it moves between the categories with the most observations, it also has the narrowest confidence interval.
  - The slope of the nested model subsetted to include only male and female folk is shown with a <span style="color: limegreen;">light green</span> dashed line. Although the confidence interval from the nested model looks almost identical to the marginal effect for the new direction, it is in fact slightly smaller.

```{r fig.height = 6.5 , fig.width = 8.5, fig.align='center'}

plot_ly( ) %>%
  add_markers(data = hairData, 
              x = ~isFemale_num,
              y = ~isMale_num,
              z = ~length,
              color = ~gender,
              colors = c("pink", "skyblue", "purple"),
              size = 1) %>% 
  add_3d.directions(formula = length~ isFemale_num+isMale_num, data = hairData,
                     model.names = model.names, define.constant.x1 =0 ,define.constant.x2 =0 ) %>%
  layout( 
    title = "\nSimulated hair length by\n gender",
    scene = list(xaxis = list(title = 'female (0 = no, 1 = yes)'),
                 yaxis = list(title = 'male (0 = no, 1 = yes)'),
                 zaxis = list(title = 'hair length')),
    legend = list(font = list(size = 8))
  )
```

## 2D visuals

```{r fig.height=8, fig.width=8}
p <- plot_ly(data = hairData, 
              x = ~isFemale_num,
              y = ~isMale_num,
              z = ~length,
              color = ~gender,
              colors = c("pink", "skyblue", "purple"),
              size = 1 ) %>%
  add_markers() %>% 
  layout( 
    title = "\nSimulated hair length by\n gender",
    scene = list(xaxis = list(title = 'female (0 = no, 1 = yes)'),
                 yaxis = list(title = 'male (0 = no, 1 = yes)'),
                 zaxis = list(title = 'hair length')),
    legend = list(font = list(size = 8))
  )
 p %>% add_2d.directions(model.names) 

```

The 2 dimensional graphics above highlight the difference between the confidence intervals in the nested models as compared to the confidence intervals in the regression surface along the direction that produces the relevant pairwise comparison between categories in the gender variable. 