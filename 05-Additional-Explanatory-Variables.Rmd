
# Adding Explanatory Variables: County level voting behavior in 2016

This example shows what happens to the regression model when additional explanatory variable are included. Any rotated version of the original model using $x_1$ and $x_2$ will produce identical coefficients and standard errors for the additional explanatory variables as the original model does. 

In particular, for any new coefficient $x_i$, the coefficient on $x_i$ in the estimated regression surface is interpreted as the marginal effect holding all other variables constant including $x_1$ and $x_2$. The interpretation of the coefficient on $x_i$ remains the same for any model that uses a rotation of $x_1$ and $x_2$. This stands in contrast to nested models, because dropping a variable produces a joint direction between all coefficients and the excluded variable(s), not just the joint change for two variables.  That is, rotated models allow you to control for all variables in the original model while providing flexibility in the direction you want to examine $x_1$ and $x_2$. 

The data in this example shows county level demographics as they relate to the percent of the county that voted for Trump in 2016.

The regression being estimated is  

\begin{align*}
\text{estimated % voting for Trump} = \beta_1 * \text{% with higher education}+ \beta_2 * \text{median income} + \beta_0 
\end{align*}

## Directional regression results

The regression results below are generated by stargazer.dira(). Model 1 in the output below shows the results for the original regression. The remaining two models show the results for various rotations on the original model. All model descriptions have been generated automatically by stargazer.dira(). 

```{r, results = 'asis'}
model.names <-  c("lm_multiple",
                  "lm_y.predby.x2.w.resids", 
                  "lm_pc.w.orth" )


stargazer.dira(formula = prcntGOP16~ anyCollege +medianIncome1k+ popEstimate16 + drugChg1980to2014, 
               data = countyData, print.model.descriptions = T,
               model.names = model.names, units.of.x1 = T , 
               type = type, 
               keep.stat = c("n","aic", "adj.rsq", "f"),
               star.cutoffs = c(0.05, 0.01, 0.001),
               covariate.labels = c("% with higher education", "median income ($1,000s)", "residuals of % with higher education",
                                    "first principal component",
                                    "orthogonal to PC 1", 
                                    "county population", "increase in drug deaths, 1980-2014",
                                    "Constant"),
               dep.var.caption = "% Trump vote in 2016"
               )
```

Note that the coefficients and standard errors on the additional variable, county population and the increase in drug deaths, remain the same across all rotations of the original model. 

To visualize these rotations, we have to drop back down to the model $y \sim x_1 + x_2$. Fortunately, the coefficients on $x_1$ and $x_2$ are similar in this model as they were in the model $y \sim x_1 + x_2 + x_3 + x_4$, as seen below. 

```{r, results = 'asis'}
model.names <-  c("lm_multiple",
                  "lm_y.predby.x2.w.resids", 
                  "lm_pc.w.orth" )

stargazer.dira(formula = prcntGOP16~ anyCollege +medianIncome1k, 
               data = countyData,
               model.names = model.names, units.of.x1 = T , 
               type = type, 
               keep.stat = c("n","aic", "adj.rsq", "f"),
               star.cutoffs = c(0.05, 0.01, 0.001),
               covariate.labels = c("% with higher education", "median income ($1,000s)", "residuals of % with higher education",
                                    "first principal component",
                                    "orthogonal to PC 1", 
                                    "Constant"),
               dep.var.caption = "% Trump vote in 2016"
               )
```

## 3D regression visualization

```{r }
plot_ly(data = countyData, 
              x = ~anyCollege,
              y = ~medianIncome1k,
              z = ~prcntGOP16 ,text = ~countyState) %>%
  add_markers(# color = ~prcntGOP16,
              size = 1, 
              name = "scatterplot of counties") %>% 
  # add_3d.directions(formula = prcntGOP16~ anyCollege + medianIncome1k, data = countyData,
  #                    model.names = model.names) %>%
  # add_3d.directions(data = countyData, 
  #             x = ~anyCollege,
  #             y = ~medianIncome1k,
  #             z = ~prcntGOP16,
  #                    model.names = model.names) %>%
  add_3d.directions(  model.names = model.names) %>%
  layout( 
    title = "\nCounty Vote for Trump by\n education & income",
    scene = list(xaxis = list(title = '% with higher education'),
                 yaxis = list(title = 'County median income ($1,000)'),
                 zaxis = list(title = '% vote for Trump 2016')),
    # width = 500, height = 500,
    legend = list(font = list(size = 8))
    )
# 
# multiple_turnout
# saveWidget(multiple_turnout, "index.html")
```

## 2D rotated model in the direction of x2 predicted by x1

```{r fig.height= 4.5, fig.width = 7.5}
p <- plot_ly(data = countyData, 
              x = ~anyCollege,
              y = ~medianIncome1k,
              z = ~prcntGOP16,
              text = ~countyState ) %>%
  add_markers(
              # color = ~prcntGOP16,
              # colors = c("black", "orange"),
              name = "scatterplot of counties") %>%
  layout( 
    title = "\nCounty Vote for Trump by\n education & income",
    scene = list(xaxis = list(title = '% with higher education'),
                 yaxis = list(title = 'County median income ($1,000)'),
                 zaxis = list(title = '% vote for Trump 2016')),
    # width = 500, height = 500,
    legend = list(font = list(size = 8))
    )


p %>% add_2d.directions(model.names, titleX = F) %>%
      add_annotations(
        text = 'y ~ x1', x = 0.15, y = 1, yref = "paper",
        xref = "paper", xanchor = "middle", yanchor = "top", showarrow = FALSE, font = list(size = 15)
      )%>%
      add_annotations(
        text = 'x2 ~ x1', x = 0.85, y = 1, yref = "paper",
        xref = "paper", xanchor = "middle", yanchor = "top", showarrow = FALSE, font = list(size = 15)
      )%>%
      add_annotations(
        text = 'County median income ($1,000)', x = 0.5, y = .02, yref = "paper",
        xref = "paper", xanchor = "middle", yanchor = "top", showarrow = FALSE, font = list(size = 15)
      )

```
